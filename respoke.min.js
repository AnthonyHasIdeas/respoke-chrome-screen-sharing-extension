function trace(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+a)}var io="undefined"==typeof module?{}:module.exports;!function(){!function(a,b){var c=a;c.version="0.9.16",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(a,d){var e,f,g=c.util.parseUri(a);b&&b.location&&(g.protocol=g.protocol||b.location.protocol.slice(0,-1),g.host=g.host||(b.document?b.document.domain:b.location.hostname),g.port=g.port||b.location.port),e=c.util.uniqueUri(g);var h={host:g.host,secure:"https"==g.protocol,port:g.port||("https"==g.protocol?443:80),query:g.query||""};return c.util.merge(h,d),(h["force new connection"]||!c.sockets[e])&&(f=new c.Socket(h)),!h["force new connection"]&&f&&(c.sockets[e]=f),f=f||c.sockets[e],f.of(g.path.length>1?g.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c},c.uniqueUri=function(a){var c=a.protocol,d=a.host,e=a.port;return"document"in b?(d=d||document.domain,e=e||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",e||"https"!=c||(e=443)),(c||"http")+"://"+d+":"+(e||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){for(var b,c={},d=a.split("&"),e=0,f=d.length;f>e;++e)b=d[e].split("="),b[0]&&(c[b[0]]=b[1]);return c};var f=!1;c.load=function(a){return"document"in b&&"complete"===document.readyState||f?a():(c.on(b,"load",a,!1),void 0)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(b){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?(c.load(function(){setTimeout(a,100)}),void 0):a()},c.merge=function(a,b,d,e){var f,g=e||[],h="undefined"==typeof d?2:d;for(f in b)b.hasOwnProperty(f)&&c.indexOf(g,f)<0&&("object"==typeof a[f]&&h?c.merge(a[f],b[f],h-1,g):(a[f]=b[f],g.push(b[f])));return a},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.intersect=function(a,b){for(var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=0,h=f.length;h>g;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=0>c?0>c+d?0:c+d:c||0;d>c&&a[c]!==b;c++);return c>=d?-1:c},c.toArray=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return void 0!=a.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}var d=this;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){for(var e=-1,f=0,g=d.length;g>f;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(0>e)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return void 0===a?(this.$events={},this):(this.$events&&this.$events[a]&&(this.$events[a]=null),this)},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;for(var e=c.slice(),f=0,g=e.length;g>f;f++)e[f].apply(this,d)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(a){return 10>a?"0"+a:a}function date(a){return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+f(a.getUTCMonth()+1)+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"Z":null}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i instanceof Date&&(i=date(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","  ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})},JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(a,b){var c=a.parser={},d=c.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",m=a.advice?h(f,a.advice):"";(""!==l||""!==m)&&(k=l+(""!==m?"+"+m:""));break;case"message":""!==a.data&&(k=a.data);break;case"event":var n={name:a.name};a.args&&a.args.length&&(n.args=a.args),k=g.stringify(n);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}var o=[b,c+("data"==j?"+":""),i];return null!==k&&void 0!==k&&o.push(k),o.join(":")},c.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,d=a.length;d>c;c++){var e=a[c];b+="ï¿½"+e.length+"ï¿½"+a[c]}return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};switch(c&&(h.id=c,h.ack=b[3]?"data":!0),h.type){case"error":var b=a.split("+");h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(k){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(k){}break;case"connect":h.qs=a||"";break;case"ack":var b=a.match(/^([0-9]+)(\+)?(.*)/);if(b&&(h.ackId=b[1],h.args=[],b[3]))try{h.args=b[3]?g.parse(b[3]):[]}catch(k){}break;case"disconnect":case"heartbeat":}return h},c.decodePayload=function(a){if("ï¿½"==a.charAt(0)){for(var b=[],d=1,e="";d<a.length;d++)"ï¿½"==a.charAt(d)?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.heartbeats=function(){return!0},c.prototype.onData=function(a){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==a){var c=b.parser.decodePayload(a);if(c&&c.length)for(var d=0,e=c.length;e>d;d++)this.onPacket(c[d])}return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),"heartbeat"==a.type?this.onHeartbeat():("connect"==a.type&&""==a.endpoint&&this.onConnect(),"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){if(this.options={port:80,secure:!1,document:"document"in c?document:!1,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},b.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"beforeunload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function c(b){b instanceof Error?(d.connecting=!1,d.onError(b.message)):a.apply(null,b.split(":"))}var d=this,f=this.options,g=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,b.protocol,b.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!b.util.ua.hasCORS){var h=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src=g+"&jsonp="+b.j.length,h.parentNode.insertBefore(i,h),b.j.push(function(a){c(a),i.parentNode.removeChild(i)})}else{var j=b.util.request();j.open("GET",g,!0),this.isXDomain()&&(j.withCredentials=!0),j.onreadystatechange=function(){4==j.readyState&&(j.onreadystatechange=e,200==j.status?c(j.responseText):403==j.status?d.onError(j.responseText):(d.connecting=!1,!d.reconnecting&&d.onError(j.responseText)))},j.send(null)}},d.prototype.getTransport=function(a){for(var c,d=a||this.transports,e=0;c=d[e];e++)if(b.Transport[c]&&b.Transport[c].check(this)&&(!this.isXDomain()||b.Transport[c].xdomainCheck(this)))return new b.Transport[c](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return c.connecting=!0,this.handshake(function(d,e,f,g){function h(a){return c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a),c.transport?(c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){for(var a=c.transports;a.length>0&&a.splice(0,1)[0]!=c.transport.name;);a.length?h(a):c.publish("connect_failed")}},c.options["connect timeout"]))}),void 0):c.publish("connect_failed")}c.sessionid=d,c.closeTimeout=1e3*f,c.heartbeatTimeout=1e3*e,c.transports||(c.transports=c.origTransports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports),c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){clearTimeout(c.connectTimeoutTimer),a&&"function"==typeof a&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},d.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},d.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},d.prototype.disconnectSync=function(){var a=b.util.request(),c=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,b.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",c,!1),a.send(null),this.onDisconnect("booted")},d.prototype.isXDomain=function(){var a=c.location.port||("https:"==c.location.protocol?443:80);return this.options.host!==c.location.hostname||this.options.port!=a},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(b||c)&&(this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer),c.removeListener("connect_failed",b),c.removeListener("connect",b),c.reconnecting=!1,delete c.reconnectionAttempts,delete c.reconnectionDelay,delete c.reconnectionTimer,delete c.redoTransports,c.options["try multiple transports"]=e}function b(){return c.reconnecting?c.connected?a():c.connecting&&c.reconnecting?c.reconnectionTimer=setTimeout(b,1e3):(c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transports=c.origTransports,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<f&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(b,this.reconnectionDelay),this.on("connect",b)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function c(){d.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var d=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];"data"==a.ack?e.push(c):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":var e=[a.name].concat(a.args);"data"==a.ack&&e.push(c),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var a,d=b.util.query(this.socket.options.query),e=this;return a||(a=c.MozWebSocket||c.WebSocket),this.websocket=new a(this.prepareUrl()+d),this.websocket.onopen=function(){e.onOpen(),e.socket.setBuffer(!1)},this.websocket.onmessage=function(a){e.onData(a.data)},this.websocket.onclose=function(){e.onClose(),e.socket.setBuffer(!0)},this.websocket.onerror=function(a){e.onError(a)},this},d.prototype.send=b.util.ua.iDevice?function(a){var b=this;return setTimeout(function(){b.websocket.send(a)},0),this}:function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;c>b;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return"WebSocket"in c&&!("__addTask"in WebSocket)||"MozWebSocket"in c},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b,c){function d(a){a&&(b.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}a.XHR=d,b.util.inherit(d,b.Transport),d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},d.prototype.payload=function(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b.parser.encodePacket(a[d]));this.send(b.parser.encodePayload(c))},d.prototype.send=function(a){return this.post(a),this},d.prototype.post=function(a){function b(){4==this.readyState&&(this.onreadystatechange=e,f.posting=!1,200==this.status?f.socket.setBuffer(!1):f.onClose())}function d(){this.onload=e,f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),c.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b,this.sendXHR.send(a)},d.prototype.close=function(){return this.onClose(),this},d.prototype.request=function(a){var c=b.util.request(this.socket.isXDomain()),d=b.util.query(this.socket.options.query,"t="+ +new Date);if(c.open(a||"GET",this.prepareUrl()+d,!0),"POST"==a)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(e){}return c},d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},d.check=function(a,d){try{var e=b.util.request(d),f=c.XDomainRequest&&e instanceof XDomainRequest,g=a&&a.options&&a.options.secure?"https:":"http:",h=c.location&&g!=c.location.protocol;if(e&&(!f||!h))return!0}catch(i){}return!1},d.xdomainCheck=function(a){return d.check(a,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(){b.Transport.XHR.apply(this,arguments)}a.htmlfile=c,b.util.inherit(c,b.Transport.XHR),c.prototype.name="htmlfile",c.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio",this.doc.body.appendChild(a),this.iframe=this.doc.createElement("iframe"),a.appendChild(this.iframe);var c=this,d=b.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+d,b.util.on(window,"unload",function(){c.destroy()})},c.prototype._=function(a,b){a=a.replace(/\\\//g,"/"),this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}},c.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},c.prototype.close=function(){return this.destroy(),b.Transport.XHR.prototype.close.call(this)},c.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var c=new(window[["Active"].concat("Object").join("X")])("htmlfile");return c&&b.Transport.XHR.check(a)}catch(d){}return!1},c.xdomainCheck=function(){return!1},b.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(){b.Transport.XHR.apply(this,arguments)}function e(){}a["xhr-polling"]=d,b.util.inherit(d,b.Transport.XHR),b.util.merge(d,b.Transport.XHR),d.prototype.name="xhr-polling",d.prototype.heartbeats=function(){return!1},d.prototype.open=function(){var a=this;return b.Transport.XHR.prototype.open.call(a),!1},d.prototype.get=function(){function a(){4==this.readyState&&(this.onreadystatechange=e,200==this.status?(f.onData(this.responseText),f.get()):f.onClose())}function b(){this.onload=e,this.onerror=e,f.retryCounter=1,f.onData(this.responseText),f.get()}function d(){f.retryCounter++,!f.retryCounter||f.retryCounter>3?f.onClose():f.get()}if(this.isOpen){var f=this;this.xhr=this.request(),c.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a,this.xhr.send(null)}},d.prototype.onClose=function(){if(b.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(a){}this.xhr=null}},d.prototype.ready=function(a,c){var d=this;b.util.defer(function(){c.call(d)})},b.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b,c){function d(){b.Transport["xhr-polling"].apply(this,arguments),this.index=b.j.length;var a=this;b.j.push(function(b){a._(b)})}var e=c.document&&"MozAppearance"in c.document.documentElement.style;a["jsonp-polling"]=d,b.util.inherit(d,b.Transport["xhr-polling"]),d.prototype.name="jsonp-polling",d.prototype.post=function(a){function c(){d(),e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{g=document.createElement('<iframe name="'+e.iframeId+'">')}catch(a){g=document.createElement("iframe"),g.name=e.iframeId}g.id=e.iframeId,e.form.appendChild(g),e.iframe=g}var e=this,f=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var g,h=document.createElement("form"),i=document.createElement("textarea"),j=this.iframeId="socketio_iframe_"+this.index;h.className="socketio",h.style.position="absolute",h.style.top="0px",h.style.left="0px",h.style.display="none",h.target=j,h.method="POST",h.setAttribute("accept-charset","utf-8"),i.name="d",h.appendChild(i),document.body.appendChild(h),this.form=h,this.area=i}this.form.action=this.prepareUrl()+f,d(),this.area.value=b.JSON.stringify(a);try{this.form.submit()}catch(k){}this.iframe.attachEvent?g.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},d.prototype.get=function(){var a=this,c=document.createElement("script"),d=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),c.async=!0,c.src=this.prepareUrl()+d,c.onerror=function(){a.onClose()};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(c,f),this.script=c,e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype._=function(a){return this.onData(a),this.isOpen&&this.get(),this},d.prototype.ready=function(a,c){var d=this;return e?(b.util.load(function(){c.call(d)}),void 0):c.call(this)},d.check=function(){return"document"in c},d.xdomainCheck=function(){return!0},b.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}(),function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function a(a){return function(){return X.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===db(a)||a instanceof T}function d(a,b){if(Q&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(fb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+fb+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===S&&d>=U&&kb>=d}function i(){if(Q)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return S=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return r(a)?a:s(a)?D(a):C(a)}function l(){function a(a){b=a,f.source=a,Z(c,function(b,c){W(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=ab(l.prototype),f=ab(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=Y(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):W(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=j(function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},"valueOf","inspect"),f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&Q)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(C(c))},e.reject=function(c){b||a(B(c))},e.notify=function(a){b||Z(d,function(b,c){W(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return B(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=ab(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=B(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=j(function(){var a=c();
return"pending"===a.state||"rejected"===a.state?d:a.value})}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){ib||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",gb),ib=!0}function x(){for(var a=0;a<gb.length;a++){var b=gb[a];b&&"undefined"!=typeof b.stack?console.warn("Unhandled rejection reason:",b.stack):console.warn("Unhandled rejection reason (no stack):",b)}}function y(){gb.length=0,hb.length=0,ib=!1,jb||(jb=!0,"undefined"!=typeof process&&process.on&&process.on("exit",x))}function z(a,b){jb&&(hb.push(a),gb.push(b),w())}function A(a){if(jb){var b=$(hb,a);-1!==b&&(hb.splice(b,1),gb.splice(b,1))}}function B(a){var b=o({when:function(b){return b&&A(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return z(b,a),b}function C(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return cb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function D(a){var b=l();return W(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function E(a){return o({isDef:function(){}},function(b,c){return K(a,b,c)},function(){return k(a).inspect()})}function F(a,b,c){return k(a).spread(b,c)}function G(a){return function(){function b(a,b){var g;if(eb){try{g=d[a](b)}catch(h){return B(h)}return g.done?g.value:p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?h.value:B(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function H(a){k.done(k.async(a)())}function I(a){throw new T(a)}function J(a){return function(){return F([this,L(arguments)],function(b,c){return a.apply(b,c)})}}function K(a,b,c){return k(a).dispatch(b,c)}function L(a){return p(a,function(a){var b=0,c=l();return Z(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function M(a){return p(a,function(a){return a=_(a,k),p(L(_(a,function(a){return p(a,V,V)})),function(){return a})})}function N(a){return k(a).allSettled()}function O(a,b){return k(a).then(void 0,void 0,b)}function P(a,b){return k(a).nodeify(b)}var Q=!1;try{throw new Error}catch(R){Q=!!R.stack}var S,T,U=i(),V=function(){},W=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(W=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=a,e=function(){g.port2.postMessage(0)}}else e=function(){setTimeout(a,0)};return W}(),X=Function.call,Y=a(Array.prototype.slice),Z=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),$=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),_=a(Array.prototype.map||function(a,b){var c=this,d=[];return Z(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),ab=Object.create||function(a){function b(){}return b.prototype=a,new b},bb=a(Object.prototype.hasOwnProperty),cb=Object.keys||function(a){var b=[];for(var c in a)bb(a,c)&&b.push(c);return b},db=a(Object.prototype.toString);T="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var eb;try{new Function("(function* (){ yield 1; })"),eb=!0}catch(R){eb=!1}var fb="From previous event:";k.resolve=k,k.nextTick=W,k.longStackSupport=!1,k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(Y(arguments,1)):a.resolve(c)}},k.promise=m,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return B(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return B(c)}}return B(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return W(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var gb=[],hb=[],ib=!1,jb=!0;k.resetUnhandledRejections=y,k.getUnhandledReasons=function(){return gb.slice()},k.stopUnhandledRejectionTracking=function(){y(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",x),jb=!1},y(),k.reject=B,k.fulfill=C,k.master=E,k.spread=F,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=G,k.spawn=H,k["return"]=I,k.promised=J,k.dispatch=K,o.prototype.dispatch=function(a,b){var c=this,d=l();return W(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,Y(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,Y(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,Y(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},k.fbind=function(a){var b=k(a),c=Y(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(Y(arguments))])}},o.prototype.fbind=function(){var a=this,b=Y(arguments);return function(){return a.dispatch("apply",[this,b.concat(Y(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=L,o.prototype.all=function(){return L(this)},k.allResolved=j(M,"allResolved","allSettled"),o.prototype.allResolved=function(){return M(this)},k.allSettled=N,o.prototype.allSettled=function(){return this.then(function(a){return L(_(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=O,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){W(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=Y(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=Y(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=Y(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=Y(arguments,1);return function(){var c=b.concat(Y(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=Y(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=Y(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(Y(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=Y(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=Y(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=Y(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=Y(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=P,o.prototype.nodeify=function(a){return a?(this.then(function(b){W(function(){a(null,b)})},function(b){W(function(){a(b)})}),void 0):this};var kb=i();return k}),function(a){var b="undefined";!function(a,b){"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define(b):this[a]=b()}("log",function(){function c(c){return typeof console===b?j:console[c]===a?d(console,"log")||j:d(console,c)}function d(b,c){var d=b[c];return d.bind===a?Function.prototype.bind===a?function(){d.apply(b,arguments)}:Function.prototype.bind.call(b[c],b):b[c].bind(b)}function e(){for(var a=0;a<k.length;a++)i[k[a]]=j}function f(){return typeof window!==b&&window.document!==a&&window.document.cookie!==a}function g(b){if(f()){var c;for(var d in i.levels)if(i.levels.hasOwnProperty(d)&&i.levels[d]===b){c=d;break}c!==a&&(window.document.cookie="loglevel="+c+";")}}function h(){var a;if(f()){var b=l.exec(window.document.cookie)||[];a=b[1]}i.setLevel(i.levels[a]||i.levels.WARN)}var i={},j=function(){},k=["trace","verbose","debug","info","warn","error"],l=/loglevel=([^;]+)/;i.levels={TRACE:0,VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,SILENT:6},i.setLevel=function(a){if("number"==typeof a&&a>=0&&a<=i.levels.SILENT){if(g(a),a===i.levels.SILENT)return e(),void 0;if(typeof console===b)throw e(),"No console available for logging";for(var d=0;d<k.length;d++){var f=k[d];i[f]=a<=i.levels[f.toUpperCase()]?c(f):j}}else{if("string"!=typeof a)throw"log.setLevel() called with invalid level: "+a;i.setLevel(i.levels[a.toUpperCase()])}},i.enableAll=function(){i.setLevel(i.levels.TRACE)},i.disableAll=function(){i.setLevel(i.levels.SILENT)};try{h()}catch(m){i.setLevel(i.levels.SILENT)}return i})}();var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;navigator.mozGetUserMedia?(console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn"))if(27>webrtcDetectedVersion){var f=a.split("?");(1===f.length||0===f[1].indexOf("transport=udp"))&&(d={url:f[0],credential:c,username:b})}else d={url:a,credential:c,username:b};return d},attachMediaStream=function(a,b){console.log("Attaching media stream"),a.mozSrcObject=b,a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream"),a.mozSrcObject=b.mozSrcObject,a.play()},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]})):navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),createIceServer=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(a,b){"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")},reattachMediaStream=function(a,b){a.src=b.src}):console.log("Browser does not appear to be WebRTC-capable"),function(){"use strict";if(window.respoke={buildNumber:"0.0.1-204-g7a81ada",streams:{},instances:{}},log.setLevel("trace"),!window.skipBugsnag){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b),a.onload=function(){Bugsnag.apiKey="dd002244e1682c1c4d8041920207467f"},a.src="https://d2wy8f7a9ursnm.cloudfront.net/bugsnag-2.min.js"}}(),Q.longStackSupport=!0,Q.stackJumpLimit=5,Q.longStackJumpLimit=20,Q.stopUnhandledRejectionTracking(),respoke.connect=function(a){"use strict";var b=respoke.Client(a);return b.connect(a),b},respoke.getClient=function(a){"use strict";return void 0===a&&log.debug("Can't call getClient with no client ID.",(new Error).stack),respoke.instances[a]||log.debug("No client instance with id",a),respoke.instances[a]},respoke.createClient=function(a){"use strict";var b;return a=a||{},a.instanceId&&(b=respoke.getClient(a.instanceId))?b:respoke.Client(a)},respoke.makeGUID=function(){"use strict";for(var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0,e=0;36>e;e+=1)8===e||13===e||18===e||23===e?c[e]="-":14===e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19===e?3&a|8:a]);return c.join("")},respoke.handlePromise=function(a,b,c){"use strict";return b||c?(b="function"==typeof b?b:function(){},c="function"==typeof c?c:function(){},a.done(b,c),void 0):a},respoke.Class=function(a){"use strict";a=a||{};{var b=a.that||{};a.client}return b.className="respoke.Class",delete a.that,delete b.client,Object.keys(a).forEach(function(c){b[c]=a[c]}),b},respoke.hasUserMedia=function(){"use strict";return(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia)instanceof Function},respoke.hasRTCPeerConnection=function(){"use strict";return(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection)instanceof Function},respoke.hasWebsocket=function(){"use strict";return(window.WebSocket||window.webkitWebSocket||window.MozWebSocket)instanceof Function},respoke.EventEmitter=function(a){"use strict";a=a||{};var b=respoke.Class(a);b.className="respoke.EventEmitter";var c={};return b.listen=function(a,b,d){void 0!==b&&(c[a]=c[a]||[],b.isInternal=!!d,"function"==typeof b&&-1===c[a].map(function(a){return a.toString()}).indexOf(b.toString())?c[a].push(b):-1!==c[a].indexOf(b)&&log.warn("not adding duplicate listener."))},b.ignore=function(a,b){if(void 0===a)return c={},void 0;if(void 0===b||!c[a])return c[a]=[],void 0;for(var d=c[a].length-1;d>=0;d-=1)if(b===c[a][d])return c[a].splice(d,1),void 0},b.fire=function(a,d){var e=0;a&&(c[a]=c[a]||[],d=d||{},d.name=a,d.target=b,d=respoke.buildEvent(d),c[a].forEach(function(c){if("function"==typeof c)try{c.call(b,d),e+=1}catch(f){log.error("Error in "+b.className+"#"+a,f.message,f.stack)}}),log.verbose("fired "+b.className+"#"+a+" "+e+" listeners called with params",d))},b.hasListeners=function(a){if(void 0===a)throw new Error("Missing required parameter event type.");return c[a]?!c[a].every(function(a){return a.isInternal}):!1},b},respoke.buildEvent=function(a){"use strict";if(!a.name)throw new Error("Can't create an Event without an event name.");if(!a.target)throw new Error("Can't create an Event without a target.");return a},respoke.Client=function(a){"use strict";function b(a){a=a||{};var g=Q.defer();return o.token||o.appId&&o.endpointId&&o.developmentMode===!0?(r.open({actuallyConnect:b,endpointId:m.endpointId,token:o.token}).then(function(){return r.authenticate()}).done(function(){m.connected=!0,m.setPresence({presence:o.presence||"available"}),m.listen("call",o.onCall),m.listen("call",e,!0),m.listen("direct-connection",o.onDirectConnection),m.listen("direct-connection",f,!0),m.listen("join",o.onJoin),m.listen("leave",o.onLeave),m.listen("message",o.onMessage),m.listen("connect",o.onConnect),m.listen("disconnect",o.onDisconnect),m.listen("disconnect",c,!0),m.listen("reconnect",o.onReconnect),m.listen("reconnect",d,!0),log.info("logged in as "+m.id,m),g.resolve()},function(a){m.connected=!1,g.reject("Couldn't create an endpoint."),log.error(a.message,a.stack)}),g.promise):(g.reject(new Error("Must pass either endpointID & appId & developmentMode=true, or a token, to client.connect().")),g.promise)}function c(){m.connected=!1}function d(){m.connected=!0}function e(a){a.call.listen("hangup",function(a){i({call:a.target})},!0),h(a)}function f(a){h({call:a.directConnection.call}),a.directConnection.listen("close",function(a){i({call:a.target.call})},!0)}function g(){m.connected=!1,q=[],p=[],m.fire("disconnect")}function h(a){if(!a.call)throw new Error("Can't add call without a call parameter.");return-1!==m.calls.indexOf(a.call)||(m.calls.push(a.call),"respoke.Call"!==a.call.className||a.call.caller||m.hasListeners("call"))?void 0:(log.warn("Got a incoming call with no handlers to accept it!"),a.call.reject(),void 0)}function i(a){var b=0;if(!a.call)throw new Error("Can't remove call without a call parameter.");for(var c=m.calls.length-1;c>=0;c-=1)m.calls[c].id===a.call.id&&(m.calls.splice(c,1),b+=1);1!==b&&log.warn("Something went wrong.",b,"calls were removed!")}function j(a){var b;if(!a||"respoke.Group"!==a.className)throw new Error("Can't add group to internal tracking without a group.");p.every(function(c){return c.id===a.id?(b=c,!1):!0}),b||(a.listen("leave",function(a){k(a.connection.getEndpoint())},!0),p.push(a))}function k(a){if(a=a||{},!a.id)throw new Error("Can't remove endpoint from internal tracking without group id.");Q.all(p.map(function(a){return a.getMembers()})).done(function(b){var c=b.every(function(b){return b.every(function(b){return b.endpointId!==a.id})});c&&q.every(function(b,c){return b.id===a.id?(q.splice(c,1),!1):!0})})}a=a||{};var l=a.instanceId||respoke.makeGUID();a.instanceId=l;var m=respoke.Presentable(a);respoke.instances[l]=m,delete m.instanceId,m.connectTries=0,m.className="respoke.Client";window.location.hostname,window.location.port;m.connected=!1;var n={setPresence:m.setPresence},o={baseURL:a.baseURL,token:a.token,appId:a.appId,developmentMode:"boolean"==typeof a.developmentMode?a.developmentMode:!1,reconnect:"boolean"==typeof a.developmentMode?a.developmentMode:!0,endpointId:a.endpointId,onJoin:a.onJoin,onLeave:a.onLeave,onMessage:a.onMessage,onConnect:a.onConnect,onDisconnect:a.onDisconnect,onReconnect:a.onReconnect,onCall:a.onCall,onDirectConnection:a.onDirectConnection};delete m.appId,delete m.baseURL,delete m.developmentMode,delete m.token;var p=[],q=[];m.calls=[],log.debug("Client ID is ",l),m.callSettings={constraints:a.constraints||{video:!0,audio:!0,optional:[],mandatory:{}},servers:a.servers||{iceServers:[]}};var r=respoke.SignalingChannel({instanceId:l,clientSettings:o});return m.connect=function(a){var c,d;return a=a||{},log.trace("Client.connect"),m.connectTries+=1,Object.keys(a).forEach(function(b){-1===["onSuccess","onError"].indexOf(b)&&void 0!==a[b]&&(o[b]=a[b])}),m.endpointId=o.endpointId,c=b(a),d=respoke.handlePromise(c,a.onSuccess,a.onError),c.then(function(){m.fire("connect")}),d},m.disconnect=function(a){a=a||{};var b=Q.defer(),c=respoke.handlePromise(b.promise,a.onSuccess,a.onError);if(r.connected){var d=p.map(function(a){a.leave()});Q.all(d).then(function(){return r.close()},function(){b.resolve()}).fin(function(){b.promise.isFulfilled()||b.resolve()}),b.promise.then(g,g)}else b.resolve();return c},m.setPresence=function(a){var b,c;return a=a||{},a.presence=a.presence||"available",log.info("sending my presence update "+a.presence),b=r.sendPresence({presence:a.presence,onSuccess:function(b){n.setPresence(a),o.presence=a.presence,"function"==typeof a.onSuccess&&a.onSuccess(b)},onError:a.onError}),b.then(function(){n.setPresence(a)}),c=respoke.handlePromise(b,a.onSuccess,a.onError)},m.getCall=function(a){var b=null,c=null;if(m.calls.every(function(c){return a.id&&c.id===a.id?(b=c,!1):!a.id&&a.endpointId&&c.remoteEndpoint.id===a.endpointId?(b=c,!1):!0}),null===b&&a.create===!0){c=m.getEndpoint({id:a.endpointId});try{b=c.startCall({id:a.id,caller:!1})}catch(d){log.error("Couldn't create Call.",d.message,d.stack)}}return b},m.setOnline=function(a){var b,c;a=a||{},a.presence=a.presence||"available";try{m.verifyConnected()}catch(d){return b=Q.reject(d),c=respoke.handlePromise(b,a.onSuccess,a.onError)}return m.setPresence(a)},m.sendMessage=function(a){var b,c;try{m.verifyConnected()}catch(d){return b=Q.reject(d),c=respoke.handlePromise(b,a.onSuccess,a.onError)}var e=m.getEndpoint({id:a.endpointId});return delete a.endpointId,e.sendMessage(a)},m.startCall=function(a){var b,c,d;try{m.verifyConnected()}catch(e){return b=Q.reject(e),c=respoke.handlePromise(b,a.onSuccess,a.onError)}return d=m.getEndpoint({id:a.endpointId}),delete a.endpointId,d.startCall(a)},m.verifyConnected=function(){if(m.connected!==!0||r.connected!==!0)throw new Error("Can't complete request when not connected. Please reconnect!")},m.join=function(a){var b=Q.defer(),c=respoke.handlePromise(b.promise,a.onSuccess,a.onError);try{m.verifyConnected()}catch(d){return b.reject(d),c}return a.id?(r.joinGroup({id:a.id}).done(function(){a.signalingChannel=r,a.instanceId=l;var c=respoke.Group(a);m.fire("join",{group:c}),j(c),c.listen("leave",function(a){k(a.connection.getEndpoint())}),b.resolve(c)},function(a){b.reject(a)}),c):(b.reject(new Error("Can't join a group with no group id.")),c)},m.getGroups=function(){return p},m.getGroup=function(a){var b;if(!a||!a.id)throw new Error("Can't get a group without group id.");return p.every(function(c){return c.id===a.id?(b=c,!1):!0}),b&&(b.listen("join",a.onJoin),b.listen("leave",a.onLeave),b.listen("message",a.onMessage)),b},m.getEndpoint=function(a){var b;if(!a||!a.id)throw new Error("Can't get an endpoint without endpoint id.");return q.every(function(c){return c.id===a.id?(b=c,!1):!0}),b||!a||a.skipCreate||(a.instanceId=l,a.signalingChannel=r,b=respoke.Endpoint(a),q.push(b)),b&&(b.listen("presence",a.onPresence),b.listen("message",a.onMessage)),b},m.getConnection=function(a){a=a||{};var b,c;if(!a||!a.connectionId)throw new Error("Can't get a connection without connection id.");if(a.endpointId&&(c=m.getEndpoint({id:a.endpointId,skipCreate:a.skipCreate})),c||q.every(function(d){if(a.endpointId){if(a.endpointId!==d.id)return!0;c=d}return d.connections.every(function(c){return c.id===a.connectionId?(b=c,!1):!0}),void 0===b}),!b&&!a.skipCreate){if(!a.endpointId||!c)throw new Error("Couldn't find an endpoint for this connection. Did you pass in the endpointId?");a.instanceId=l,b=respoke.Connection(a),c.connections.push(b)}return b},m.getEndpoints=function(){return q},m},respoke.Presentable=function(a){"use strict";a=a||{};var b=a.instanceId,c=respoke.EventEmitter(a);delete c.instanceId,c.className="respoke.Presentable",c.presence="unavailable";var d=respoke.getClient(b);return c.setPresence=function(a){var b;if(a=a||{},a.presence=a.presence||"available",a.connectionId=a.connectionId||c.connectionId,"respoke.Client"===c.className||"respoke.Connection"===c.className)c.presence=a.presence,"respoke.Connection"===c.className&&c.getEndpoint().resolvePresence();else if("respoke.Endpoint"===c.className){if(!a.connectionId)throw new Error("Can't set Endpoint presence without a connectionId.");b=c.getConnection({connectionId:a.connectionId})||d.getConnection({connectionId:a.connectionId,skipCreate:!1,endpointId:c.id}),b.presence=a.presence,c.resolvePresence()}c.fire("presence",{presence:c.presence})},c.getPresence=function(){return c.presence},c},respoke.Endpoint=function(a){"use strict";a=a||{};var b=a.instanceId,c=respoke.Presentable(a),d=respoke.getClient(b),e=a.signalingChannel,f=function(a){return JSON.parse(JSON.stringify(a))};return delete c.signalingChannel,delete c.instanceId,delete c.connectionId,c.className="respoke.Endpoint",c.directConnection=null,c.connections=[],d.listen("disconnect",function(){c.connections=[]}),c.sendMessage=function(a){var b,d;return a=a||{},b=e.sendMessage({connectionId:a.connectionId,message:a.message,recipient:c}),d=respoke.handlePromise(b,a.onSuccess,a.onError)},c.startAudioCall=function(a){return a=a||{},a.constraints={video:!1,audio:!0,optional:[],mandatory:{}},c.startCall(a)},c.startVideoCall=function(a){return a=a||{},a.constraints={video:!0,audio:!0,optional:[],mandatory:{}},c.startCall(a)},c.startCall=function(a){var g=null,h=f(d.callSettings);return a=a||{},log.trace("Endpoint.call"),d.verifyConnected(),log.debug("Default callSettings is",h),void 0===a.caller&&(a.caller=!0),c.id?(h.constraints=a.constraints||h.constraints,h.servers=a.servers||h.servers,log.debug("Final callSettings is",h),a.callSettings=h,a.instanceId=b,a.remoteEndpoint=c,a.signalOffer=function(a){a.signalType="offer",a.target="call",a.recipient=c,e.sendSDP(a).done(null,function(b){log.error("Couldn't place a call.",b.message,b.stack),a.call.hangup()})},a.signalAnswer=function(a){a.signalType="answer",a.target="call",a.recipient=c,e.sendSDP(a).done(null,function(b){log.error("Couldn't answer the call.",b.message,b.stack),a.call.hangup({signal:!1})})},a.signalConnected=function(a){a.target="call",a.connectionId=a.connectionId,a.recipient=c,e.sendConnected(a).done(null,function(b){log.error("Couldn't send connected.",b.message,b.stack),a.call.hangup()})},a.signalModify=function(a){a.target="call",a.recipient=c,e.sendModify(a).done(null,function(a){log.error("Couldn't send modify.",a.message,a.stack)})},a.signalCandidate=function(a){a.target="call",a.recipient=c,e.sendCandidate(a).done(null,function(a){log.error("Couldn't send candidate.",a.message,a.stack)})},a.signalHangup=function(a){a.target="call",a.recipient=c,e.sendHangup(a).done(null,function(a){log.error("Couldn't send hangup.",a.message,a.stack)})},a.signalReport=function(a){log.debug("Sending debug report",a.report),e.sendReport(a)},a.signalingChannel=e,g=respoke.Call(a),a.caller===!0&&g.answer(),g):(log.error("Can't start a call without endpoint ID!"),void 0)},c.startDirectConnection=function(a){var g,h=f(d.callSettings),i=Q.defer(),j=respoke.handlePromise(i.promise,a.onSuccess,a.onError);a=a||{};try{d.verifyConnected()}catch(k){return i.reject(k),j}return c.directConnection?(i.resolve(c.directConnection),j):(log.trace("Endpoint.startDirectConnection",a),void 0===a.caller&&(a.caller=!0),c.id?(h.constraints=a.constraints||h.constraints,h.servers=a.servers||h.servers,a.callSettings=h,a.instanceId=b,a.remoteEndpoint=c,a.signalOffer=function(a){a.signalType="offer",a.target="directConnection",a.recipient=c,e.sendSDP(a).done(null,function(b){log.error("Couldn't place a call.",b.message,b.stack),a.call.hangup()})},a.signalConnected=function(a){a.target="directConnection",a.recipient=c,e.sendConnected(a).done(null,function(b){log.error("Couldn't send connected.",b.message,b.stack),a.call.hangup()})},a.signalAnswer=function(a){a.target="directConnection",a.recipient=c,a.signalType="answer",e.sendSDP(a).done(null,function(b){log.error("Couldn't answer the call.",b.message,b.stack),a.call.hangup({signal:!1})})},a.signalCandidate=function(a){a.target="directConnection",a.recipient=c,e.sendCandidate(a).done(null,function(a){log.error("Couldn't send candidate.",a.message,a.stack)})},a.signalHangup=function(a){a.target="directConnection",a.recipient=c,e.sendHangup(a).done(null,function(a){log.error("Couldn't send hangup.",a.message,a.stack)})},a.signalReport=function(a){a.report.target="directConnection",log.debug("Not sending report"),log.debug(a.report)},a.directConnectionOnly=!0,a.offerOptions={mandatory:{OfferToReceiveAudio:!1}},g=respoke.Call(a),g.listen("direct-connection",function(b){if(c.directConnection=b.directConnection,a.caller!==!0){if(!d.hasListeners("direct-connection")&&!d.hasListeners("direct-connection")&&!g.hasListeners("direct-connection"))return c.directConnection.reject(),i.reject(new Error("Got an incoming direct connection with no handlers to accept it!")),void 0;i.resolve(c.directConnection),c.directConnection.listen("close",function(){c.directConnection=void 0},!0)}},!0),a.caller===!0&&g.answer(a),j):(i.reject(new Error("Can't start a direct connection without endpoint ID!")),j))},c.resolvePresence=function(){var a,b=["chat","available","away","dnd","xa","unavailable"];a=c.connections.sort(function(a,c){var d=b.indexOf(a.presence),e=b.indexOf(c.presence);return d=-1===d?1e3:d,e=-1===e?1e3:e,e>d?-1:d>e?1:0}),c.presence=a[0]?a[0].presence:"unavailable"},c.getConnection=function(a){var b;if(a=a||{},1===c.connections.length&&(!a.connectionId||c.connections[0]===a.connectionId))return c.connections[0];if(!a||!a.connectionId)throw new Error("Can't find a connection without the connectionId.");return c.connections.every(function(c){return c.id===a.connectionId?(b=c,!1):!0
}),b},c},respoke.Connection=function(a){"use strict";a=a||{};var b=a.instanceId,c=respoke.Presentable(a),d=respoke.getClient(b);if(c.id=c.id||c.connectionId,!c.id)throw new Error("Can't make a connection without an id.");return delete c.instanceId,delete c.connectionId,c.className="respoke.Connection",c.sendMessage=function(a){return a=a||{},a.connectionId=c.id,c.getEndpoint().sendMessage(a)},c.startCall=function(a){return a=a||{},a.connectionId=c.id,c.getEndpoint().startCall(a)},c.startAudioCall=function(a){return a=a||{},a.connectionId=c.id,a.constraints={video:!1,audio:!0,optional:[],mandatory:{}},c.startCall(a)},c.startVideoCall=function(a){return a=a||{},a.connectionId=c.id,c.getEndpoint().startCall(a)},c.startDirectConnection=function(a){return a=a||{},a.connectionId=c.id,c.getEndpoint().startDirectConnection(a)},c.getEndpoint=function(){return d.getEndpoint({id:c.endpointId})},c},respoke.SignalingChannel=function(a){"use strict";function b(a){a=a||{};var b=Q.defer();return log.trace("SignalingChannel.doOpen",a),a.token?(g({path:"/v1/appauthsessions",httpMethod:"POST",parameters:{tokenId:a.token}}).done(function(a){200===a.code?(t=a.result.token,b.resolve(),log.trace("Signaling connection open to",n.baseURL),j.connected=!0):(j.connected=!1,b.reject(new Error("Couldn't authenticate app.")))},function(a){log.error("Network call failed:",a.message),b.reject(new Error("Couldn't authenticate app."))}),b.promise):(b.reject(new Error("Can't open connection to Respoke without a token.")),b.promise)}function c(a){return a[0].toUpperCase()+a.slice(1)}function d(a){var b,c;if(a.header.from!==k.endpointId&&(log.verbose("socket.on presence",a),b=k.getEndpoint({id:a.header.from,instanceId:i,name:a.header.from,connection:a.header.fromConnection}),b.setPresence({connectionId:a.header.fromConnection,presence:a.type}),"unavailable"===b.getPresence())){var c=k.getGroups();c&&c.forEach(function(b){b.removeMember({connectionId:a.header.fromConnection})})}}function e(){t=void 0,s=void 0,q=null===q?500:2*q,q>r&&(q=r),setTimeout(function(){p().then(function(){return q=null,log.debug("socket reconnected"),Q.all(k.getGroups().map(function(a){k.join({id:a.id,onMessage:n.onMessage,onJoin:n.onJoin,onLeave:n.onLeave})}))}).done(function(){k.fire("reconnect")},function(a){log.error("Couldn't rejoin previous groups.",a.message,a.stack),e()})},q)}function f(a){a=a||{};var b=Q.defer();return a?a.path?(a.httpMethod=(a.httpMethod||"get").toLowerCase(),a.objectId&&(a.path=a.path.replace(/\%s/gi,a.objectId)),-1===a.path.indexOf("messages")&&-1===a.path.indexOf("signaling")&&log.verbose("socket request",a.httpMethod,a.path,a.parameters),l?(l.emit(a.httpMethod,JSON.stringify({url:a.path,data:a.parameters,headers:{"App-Token":t}}),function(c){-1===a.path.indexOf("messages")&&-1===a.path.indexOf("signaling")&&log.verbose("socket response",a.httpMethod,a.path,c);try{c=JSON.parse(c)}catch(d){throw new Error("Server response could not be parsed!",c)}c&&c.error?b.reject(new Error(c.error+"("+a.httpMethod+" "+a.path+")")):b.resolve(c)}),b.promise):(b.reject(new Error("Can't complete request when not connected. Please reconnect!")),b.promise)):(b.reject(new Error("No request path.")),b.promise):(b.reject(new Error("No params.")),b.promise)}function g(a){var b=Q.defer(),c=null,d=null,e=null,e={result:null,code:null};if(d=n.baseURL+a.path,!a)return b.reject(new Error("No params.")),void 0;if(!a.httpMethod)return b.reject(new Error("No HTTP method.")),void 0;if(!a.path)return b.reject(new Error("No request path.")),void 0;if(a.objectId&&(a.path=a.path.replace(/\%s/gi,a.objectId)),["GET","DELETE"].indexOf(a.httpMethod)>-1&&(d+=h(a.parameters)),u.open(a.httpMethod,d),["POST","PUT"].indexOf(a.httpMethod)>-1){c=JSON.stringify(a.parameters);try{u.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t&&u.setRequestHeader("App-Token",t)}catch(f){return b.reject(new Error("Can't set content-type header in readyState "+u.readyState+". "+f.message)),void 0}}else if(-1===["GET","DELETE"].indexOf(a.httpMethod))return b.reject(new Error("Illegal HTTP request method "+a.httpMethod)),void 0;log.verbose("calling",a.httpMethod,d,"with params",c);try{u.send(c)}catch(g){return b.reject(g),void 0}return u.onreadystatechange=function(){if(4===this.readyState){if(0===this.status)return b.reject(new Error("Status is 0: Incomplete request, SSL error, or CORS error.")),void 0;if(!([200,204,205,302,401,403,404,418].indexOf(this.status)>-1))return b.reject(new Error("unexpected response "+this.status)),void 0;if(e.code=this.status,e.uri=d,e.params=a.parameters,this.response)try{e.result=JSON.parse(this.response)}catch(c){e.result=this.response,e.error="Invalid JSON."}log.verbose(e),b.resolve(e)}},b.promise}function h(a){var b=[];return a?(Object.keys(a).forEach(function(c){var d=a[c];d instanceof Array?b.push([c,d.join(",")].join("=")):"object"!=typeof d&&"function"!=typeof d&&b.push([c,d].join("="))}),b.length>0?"?"+b.join("&"):""):""}a=a||{};var i=a.instanceId,j=respoke.EventEmitter(a);delete j.instanceId,j.className="respoke.SignalingChannel";var k=respoke.getClient(i);j.connected=!1;var l=null,m=null,n=a.clientSettings;delete j.clientSettings,n.baseURL=n.baseURL||"https://api.respoke.io";var o={},p=null,q=null,r=3e5,s=null,t=null,u=new XMLHttpRequest,v={},w={message:[],signal:[],presence:[]};j.open=function(a){a=a||{};var c=Q.defer();return log.trace("SignalingChannel.open",a,n),s=a.token||s,p="function"==typeof a.actuallyConnect?a.actuallyConnect:p,Q.fcall(function(){return n.developmentMode===!0&&n.appId&&a.endpointId?j.getToken({appId:n.appId,endpointId:a.endpointId}):null}).then(function(a){return s=a||s,b({token:s})}).done(function(){c.resolve(),log.verbose("client",k)},function(a){c.reject(a)}),c.promise},j.getToken=function(a){a=a||{};var b=Q.defer();log.trace("SignalingChannel.getToken",a);var c={path:"/v1/tokens",httpMethod:"POST",parameters:{appId:n.appId,endpointId:a.endpointId,ttl:21600}};return g(c).done(function(a){return 200===a.code&&a.result&&a.result.tokenId?(s=a.result.tokenId,b.resolve(a.result.tokenId),void 0):(b.reject(new Error("Couldn't get a developer mode token.")),void 0)},function(a){log.error("Network call failed:",a.message),b.reject(new Error("Couldn't get a developer mode token."))}),b.promise},j.close=function(a){a=a||{};var b=Q.defer();return clearInterval(m),f({path:"/v1/endpointconnections/%s/",httpMethod:"DELETE",objectId:k.endpointId}).fin(function(){g({path:"/v1/appauthsessions",httpMethod:"DELETE"}).done(function(){l.removeAllListeners(),l.disconnect(),j.connected=!1,b.resolve()},function(a){log.error("Couldn't log out app. Network call failed:",a.message),b.resolve()})}),b.promise},j.sendPresence=function(a){a=a||{};var b=Q.defer();return log.trace("Signaling sendPresence"),f({path:"/v1/presence",httpMethod:"POST",parameters:{presence:{show:a.show,status:a.status,namespace:n.appId,type:a.presence||"available"}}}).done(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.getGroup=function(a){a=a||{};var b=Q.defer();return log.trace("signalingChannel.getGroup"),f({httpMethod:"POST",path:"/v1/channels/",parameters:{name:a.name}}).then(function(a){b.resolve(a)},function(){b.resolve({id:a.name})}),b.promise},j.leaveGroup=function(a){a=a||{};var b=Q.defer();return f({path:"/v1/channels/%s/subscribers/",objectId:a.id,httpMethod:"DELETE"}).done(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.joinGroup=function(a){a=a||{};var b=Q.defer();return f({path:"/v1/channels/%s/subscribers/",objectId:a.id,httpMethod:"POST"}).done(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.publish=function(a){a=a||{};var b=Q.defer(),c=respoke.TextMessage({endpointId:a.id,message:a.message});return f({path:"/v1/channels/%s/publish/",objectId:a.id,httpMethod:"POST",parameters:c}).done(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.registerPresence=function(a){f({httpMethod:"POST",path:"/v1/presenceobservers",parameters:{endpointList:a.endpointList}}).done(function(){a.endpointList.forEach(function(a){o[a]=!0})})},j.getGroupMembers=function(a){var b,c=Q.defer();return a.id?(b=f({path:"/v1/channels/%s/subscribers/",objectId:a.id,httpMethod:"GET"}),b.done(function(a){a.forEach(function(a){o[a.endpointId]=!0})}),b):(c.reject(new Error("Can't get group's endpoints without group ID.")),c.promise)},j.sendMessage=function(a){a=a||{};var b=Q.defer(),c=respoke.TextMessage({endpointId:a.recipient.id,connectionId:a.connectionId,message:a.message});return f({path:"/v1/messages",httpMethod:"POST",parameters:c}).then(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.sendACK=function(a){var b;return a=a||{},a.signal?(b=k.getEndpoint({id:a.signal.endpointId}),b?j.sendSignal({recipient:b,signalType:"ack",signalId:a.signal.signalId,sessionId:a.signal.sessionId,target:a.signal.target,ackedSignalType:a.signal.signalType}):Q.reject("Can't send ACK, can't get endpoint.")):Q.reject("Can't send ACK, no signal was given.")},j.sendSignal=function(a){a=a||{};var b,c=Q.defer();a.call&&(a.sessionId=a.call.id,a.call.connectionId&&(a.connectionId=a.call.connectionId));try{a.signalId=respoke.makeGUID(),b=respoke.SignalingMessage(a)}catch(d){return c.reject(d),c.promise}return f({path:"/v1/signaling",httpMethod:"POST",parameters:{signal:JSON.stringify(b),to:b.to,toConnection:b.toConnection}}).done(function(){c.resolve()},function(a){c.reject(a)}),c.promise},j.sendCandidate=function(a){return a=a||{},a.signalType="iceCandidates",j.sendSignal(a)},j.sendSDP=function(a){return a=a||{},-1===["offer","answer"].indexOf(a.signalType)?Q.reject("Not an SDP type signal."):j.sendSignal(a)},j.sendReport=function(a){a=a||{};var b=Q.defer(),c={debugData:a};return f({path:"/v1/calldebugs",httpMethod:"POST",parameters:c}).then(function(){b.resolve()},function(a){b.reject(a)}),b.promise},j.sendHangup=function(a){return a=a||{},a.signalType="hangup",j.sendSignal(a)},j.sendConnected=function(a){return a=a||{},a.signalType="connected",j.sendSignal(a)},j.sendModify=function(a){return a=a||{},a.signalType="modify",-1===["initiate","accept","reject"].indexOf(a.action)?Q.reject("No valid action in modify signal."):j.sendSignal(a)},j.routeSignal=function(a){var b,d=null,e="do";"iceCandidates"!==a.signalType&&log.verbose(a.signalType,a),Q.fcall(function(){return b="offer"===a.signalType,d=k.getCall({id:a.sessionId,endpointId:a.endpointId,create:b&&"call"===a.target})}).then(function(b){return b||"directConnection"!==a.target?b:k.getEndpoint({id:a.endpointId}).startDirectConnection({id:a.sessionId,create:"offer"===a.signalType,caller:"offer"!==a.signalType})}).done(function(b){return b&&(b=b.call||b),b&&b.id===a.sessionId?(e+=c(a.signalType),v[e]({call:b,signal:a}),void 0):(log.warn("Couldn't associate signal with a call.",a),void 0)},null)},v.doOffer=function(a){a.call.connectionId=a.signal.connectionId,a.call.fire("signal-offer",{signal:a.signal})},v.doConnected=function(a){a.call.fire("signal-connected",{signal:a.signal})},v.doModify=function(a){a.call.fire("signal-modify",{signal:a.signal})},v.doAnswer=function(a){a.call.connectionId=a.signal.connectionId,a.call.fire("signal-answer",{signal:a.signal})},v.doIceCandidates=function(a){a.call.fire("signal-icecandidates",{signal:a.signal})},v.doHangup=function(a){a.call.connectionId&&a.call.connectionId!==a.signal.connectionId||a.call.fire("signal-hangup",{signal:a.signal})},v.doUnknown=function(a){log.error("Don't know what to do with",a.signal.target,"msg of unknown type",a.signal.signalType)},j.addHandler=function(a){l.socket&&l.socket.open?l.on(a.type,a.handler):w[a.type].push(a.handler)};var x=function(a){var b,c;a.header.from!==k.endpointId&&(c=respoke.TextMessage({rawMessage:a}),b=k.getGroup({id:a.header.channel}),b&&b.fire("message",{message:c}),k.fire("message",{message:c,group:b||null}))},y=function(a){var b,c,d;if(a.endpoint!==k.endpointId){if(c=k.getEndpoint({id:a.endpoint,instanceId:i,name:a.endpoint}),d=c.getConnection({connectionId:a.connectionId}),(a.header.channel.indexOf("system")>-1||!d)&&(c.setPresence({connectionId:a.connectionId}),d=k.getConnection({connectionId:a.connectionId,endpointId:a.endpoint}),a.header.channel.indexOf("system")>-1))return log.error("Still getting these weird join presence messages.",a),void 0;o[a.endpoint]||j.registerPresence({endpointList:[a.endpoint]}),b=k.getGroup({id:a.header.channel}),b&&d?b.addMember({connection:d}):log.error("Can't add endpoint to group:",a,b,c,d)}},z=function(a){var b,c;a.endpointId!==k.endpointId&&(c=k.getEndpoint({id:a.endpointId}),c.connections.every(function(b,d){return b.id===a.connectionId?(c.connections.splice(d,1),!1):!0}),b=k.getGroup({id:a.header.channel}),b.removeMember({connectionId:a.connectionId}))},A=function(a){var b;a=respoke.TextMessage({rawMessage:a}),a.endpointId&&(b=k.getEndpoint({id:a.endpointId,skipCreate:!0})),b&&b.fire("message",{message:a}),k.fire("message",{endpoint:b||null,message:a})},B=function(a,b){return a=a||function(){},b=b||function(){},function(){Object.keys(w).forEach(function(a){w[a]&&(w[a].forEach(function(b){l.on(a,b)}),w[a]=[])}),f({path:"/v1/endpointconnections",httpMethod:"POST"}).then(function(b){log.debug("endpointconnections result",b),k.endpointId=b.endpointId,k.connectionId=b.id,a()},b)}};return j.authenticate=function(a){a=a||{};var b=Q.defer(),c=[],f=null,g=null,h=null;t||b.reject(new Error("Can't open a websocket without an app token.")),c=n.baseURL.split(/:\/\//),f=c[0],c=c[1].split(/:/),g=c[0],h=c[1];var i={"connect timeout":2e3,"reconnection limit":18e6,"max reconnection attempts":1/0,"force new connection":!0,"sync disconnect on unload":!0,reconnect:!1,host:g,port:h||"443",protocol:f,secure:"https"===f,query:"app-token="+t};return l=io.connect(n.baseURL+"?app-token="+t,i),l.on("connect",B(function(){b.resolve(),m=setInterval(function(){j.sendMessage({message:"heartbeat",recipient:{id:"system-heartbeat"}}).done(null,function(a){a.message.indexOf("Not authorized")>-1&&(clearInterval(m),l.disconnect())})},5e3)},function(a){b.reject(a)})),l.on("join",y),l.on("leave",z),l.on("pubsub",x),l.on("message",A),l.on("presence",d),l.on("connect_failed",function(a){log.error("Socket.io connect failed.",a||""),e()}),l.on("error",function(a){log.trace("Socket.io error.",a||""),k.connected||e()}),j.addHandler({type:"signal",handler:function(a){var b=["offer","answer","connected","modify","iceCandidates","hangup"],c=respoke.SignalingMessage({rawMessage:a});if("ack"!==c.signalType){if(!c.target||!c.signalType||-1===b.indexOf(c.signalType))throw log.error("Got malformed signal.",c),new Error("Can't route signal without target or type.");j.routeSignal(c)}}}),l.on("disconnect",function(){return k.fire("disconnect"),clearInterval(m),n.reconnect!==!0?(l=null,void 0):(e(),void 0)}),b.promise},j.getTurnCredentials=function(){var a=Q.defer();return f({httpMethod:"GET",path:"/v1/turn"}).done(function(b){var c=[];return b&&b.uris?(b.uris.forEach(function(a){var d=null;a&&(d=createIceServer(a,b.username,b.password),c.push(d))}),0===c.length&&a.reject(new Error("Got no TURN credentials.")),log.debug("TURN creds",c),a.resolve(c),void 0):(a.reject(new Error("Turn credentials empty.")),void 0)},function(b){a.reject(b)}),a.promise},j},respoke.TextMessage=function(a){"use strict";function b(){if(a.rawMessage){try{c.endpointId=a.rawMessage.header.from,c.connectionId=a.rawMessage.header.fromConnection}catch(b){throw new Error(b)}c.message=a.rawMessage.message||a.rawMessage.body,a.rawMessage.header.channel&&(c.recipient=a.rawMessage.header.channel)}else{try{c.to=a.endpointId,c.toConnection=a.connectionId,c.requestConnectionReply=a.requestConnectionReply===!0}catch(b){throw new Error(b)}c.message=a.message}}a=a||{};var c={};return b(),c},respoke.SignalingMessage=function(a){"use strict";function b(){if(a.rawMessage)try{c=JSON.parse(a.rawMessage.signal),c.endpointId=a.rawMessage.header.from,c.connectionId=a.rawMessage.header.fromConnection}catch(b){throw new Error(b)}else d.forEach(function(b){if(0===a[b]||!a[b])throw new Error("Can't build a signaling without "+b)}),e.forEach(function(b){(0===a[b]||a[b])&&(c[b]=a[b])}),c.to=a.recipient.id,c.toConnection=a.connectionId}a=a||{};var c={},d=["recipient","signalType","sessionId","target","signalId"],e=["signalType","sessionId","callerId","sdp","iceCandidates","offering","target","signalId","requesting","reason","error","status"];return b(),c},respoke.Group=function(a){"use strict";a=a||{};var b=respoke.EventEmitter(a),c=a.instanceId,d=respoke.getClient(c);if(!b.id)throw new Error("Can't create a group without an ID.");var e=a.signalingChannel;return delete a.signalingChannel,b.connections=[],b.className="respoke.Group",b.listen("join",a.onJoin),b.listen("message",a.onMessage),b.listen("leave",a.onLeave),d.listen("disconnect",function(){b.connections=[]}),delete b.instanceId,delete b.onMessage,delete b.onPresence,delete b.onJoin,delete b.onLeave,b.leave=function(a){a=a||{};var c=Q.defer();if(!e||!e.connected)throw new Error("Can't complete request when not connected. Please reconnect!");return e.leaveGroup({id:b.id}).done(function(){d.fire("leave",{group:b}),c.resolve()},function(){c.reject()}),c.promise},b.removeMember=function(a){if(a=a||{},!a.connectionId)throw new Error("Can't remove a Connection from a group without an id.");b.connections.every(function(c,d){return c.id===a.connectionId?(b.connections.splice(d,1),b.fire("leave",{connection:c}),!1):!0})},b.addMember=function(a){a=a||{};var c;if(!a.connection)throw new Error("Can't add member to a group without a connection.");if(c=b.connections.every(function(b){return b.id!==a.connection.id})){if(b.connections.push(a.connection),a.skipEvent)return;b.fire("join",{connection:a.connection})}},b.sendMessage=function(a){if(a=a||{},a.id=b.id,!e||!e.connected)throw new Error("Can't complete request when not connected. Please reconnect!");return e.publish(a)},b.getMembers=function(a){a=a||{};var c=Q.defer();if(b.connections.length>0)return c.resolve(b.connections),c.promise;if(!e||!e.connected)throw new Error("Can't complete request when not connected. Please reconnect!");return e.getGroupMembers({id:b.id}).done(function(a){var f=[];a.forEach(function(a){var c=d.getConnection({endpointId:a.endpointId,connectionId:a.connectionId});-1===f.indexOf(a.endpointId)&&f.push(a.endpointId),b.addMember({connection:c,skipEvent:!0})}),f.length>0&&e.registerPresence({endpointList:f}),c.resolve(b.connections)},function(a){c.reject(a)}),c.promise},b},respoke.Call=function(a){"use strict";function b(){log.trace("Call.init"),void 0!==q&&(r=Q.defer(),s=Q.defer(),u=Q.defer(),t=Q.defer(),v=Q.defer()),M.init(I),void 0===q&&y===!0&&h(a),Q.all([w.promise,t.promise]).spread(function(a,b){c(b),M.listen("connect",e,!0),M.listen("remote-stream-removed",d,!0),p.fire("answer"),A!==!0&&null===y?g(b):"function"!=typeof x&&p.approve()}).done(),p.caller!==!0?Q.all([u.promise,r.promise]).spread(function(a,b){b&&b.sdp&&M.processOffer(b.sdp)},function(){log.warn("Call rejected.")}).done():Q.all([u.promise,v.promise]).spread(function(a,b){b&&M.initOffer()},function(){var a="Call not approved locally or local media error.";p.fire("error",{reason:a})}),y!==!0&&C.fire("call",{endpoint:p.remoteEndpoint,call:p})}function c(a){p.listen("local-stream-received",a.onLocalMedia),p.listen("connect",a.onConnect),p.listen("hangup",a.onHangup),p.listen("allow",a.onAllow),p.listen("answer",a.onAnswer),p.listen("approve",a.onApprove),p.listen("mute",a.onMute),p.listen("requesting-media",a.onRequestingMedia),B="boolean"==typeof a.forceTurn?a.forceTurn:B,A="boolean"==typeof a.receiveOnly?a.receiveOnly:A,z="boolean"==typeof a.sendOnly?a.sendOnly:z,y="boolean"==typeof a.directConnectionOnly?a.directConnectionOnly:y,x="function"==typeof a.previewLocalMedia?a.previewLocalMedia:x,I=a.callSettings||I||{},I.servers=a.servers||I.servers,I.constraints=a.constraints||I.constraints,I.disableTurn=a.disableTurn||I.disableTurn,M.callSettings=I,M.forceTurn=B,M.receiveOnly=A,M.sendOnly=z,M.listen("stats",function(a){p.fire("stats",{stats:a.stats})},!0),delete p.signalOffer,delete p.signalConnected,delete p.signalAnswer,delete p.signalHangup,delete p.signalReport,delete p.signalCandidate,delete p.onConnect,delete p.onLocalMedia,delete p.callSettings,delete p.directConnectionOnly}function d(){log.trace("pc event: remote stream removed")}function e(a){log.debug("received remote media",a),F=document.createElement("video"),attachMediaStream(F,a.stream),F.autoplay=!0,F.used=!0,F.play(),p.fire("connect",{element:F})}function f(a){return M&&M.getStats?(p.listen("stats",a.onStats),delete a.onStats,M.getStats(a)):null}function g(a){var b;return log.trace("Call.doAddVideo"),a=a||{},c(a),a.constraints=a.constraints||I.constraints,a.pc=M,a.instanceId=o,b=respoke.LocalMedia(a),b.listen("requesting-media",function(){p.fire("requesting-media")},!0),b.listen("allow",function(){p.fire("allow")},!0),b.listen("stream-received",function(a){v.resolve(b),M.addStream(a.stream),E=a.element,"function"==typeof x?x(a.element,p):p.approve(),p.fire("local-stream-received",{element:a.element,stream:b})},!0),b.listen("error",function(a){var c=a.reason;p.removeStream({id:b.id}),M.report.callStoppedReason=c,p.fire("error",{reason:c})}),K.push(b),b}function h(a){return log.trace("Call.actuallyAddDirectConnection",a),a=a||{},v.promise.then(a.onSuccess,a.onError),J&&J.isActive()?(v.promise.isPending()&&v.resolve(J),log.warn("Not creating a new direct connection."),v.promise):(a.instanceId=o,a.pc=M,a.call=p,J=respoke.DirectConnection(a),J.listen("close",function(){0===K.length?(log.debug("Hanging up because there are no local streams."),p.hangup()):J&&J.isActive()&&p.removeDirectConnection({skipModify:!0})},!0),J.listen("accept",function(){p.caller===!1?(log.debug("Answering as a result of approval."),p.answer(),v&&v.promise.isPending()&&p.approve()):(u.promise.isPending()&&u.resolve(!0),v.resolve(J))},!0),J.listen("open",function(){y=null},!0),J.listen("error",function(a){v.reject(new Error(a))},!0),p.remoteEndpoint.directConnection=J,p.fire("direct-connection",{directConnection:J,endpoint:p.remoteEndpoint}),C.fire("direct-connection",{directConnection:J,endpoint:p.remoteEndpoint}),p.caller===!0&&J.accept(),v.promise)}function i(a){log.trace("listenOffer");var b={};q&&q.promise.isPending()&&(y===!0?b.directConnection=J:y===!1||(b.call=p,b.constraints=I.constraints),p.fire("modify",b)),r.resolve(a.signal)}function j(a){return log.trace("Call.listenAnswer"),s.promise.isFulfilled()?(log.debug("Ignoring duplicate answer."),void 0):(s.resolve(a.signal.sdp),void 0)}function k(a){log.trace("Call.listenModify",a),"initiate"===a.signal.action&&(q=Q.defer())}function l(a){return p.caller="initiate"===a.signal.action?!1:!0,b(),"initiate"!==a.signal.action?(q.resolve(),q=void 0,void 0):(a.signal.directConnection===!0?h().done(function(a){J=a,J.accept()}):a.signal.directConnection===!1&&J&&(p.removeDirectConnection({skipModify:!0}),v.resolve(!1),u.resolve(!1)),y="boolean"==typeof a.signal.directConnection?a.signal.directConnection:null,I.constraints=a.signal.constraints||I.constraints,void 0)}function m(a){"initiate"!==a.signal.action&&(v.reject(a.err),q.reject(a.err),q=void 0)}function n(a){M.report.callStoppedReason=a.signal.reason||"Remote side hung up",p.hangup({signal:!1})}a=a||{};var o=a.instanceId,p=respoke.EventEmitter(a);if(delete p.instanceId,p.className="respoke.Call",p.caller?p.id=respoke.makeGUID():p.caller=!1,!p.id)throw new Error("Can't start a new call without a call id.");var q,r=Q.defer(),s=Q.defer(),t=Q.defer(),u=Q.defer(),v=Q.defer(),w=Q.defer(),x=null,y=null,z=null,A=null,B=null,C=respoke.getClient(o),D=a.signalingChannel;delete a.signalingChannel,delete p.signalingChannel;var E=null,F=null,G=!1,H=!1,I=a.callSettings,J=null,K=[],L=null,M=respoke.PeerConnection({instanceId:o,forceTurn:B,call:p,callSettings:I,pcOptions:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]},offerOptions:a.offerOptions||null,signalOffer:a.signalOffer,signalConnected:a.signalConnected,signalAnswer:a.signalAnswer,signalModify:a.signalModify,signalHangup:a.signalHangup,signalReport:a.signalReport,signalCandidate:a.signalCandidate});return p.answer=function(a){a=a||{},log.trace("Call.answer"),t.promise.isPending()&&t.resolve(a)},p.accept=p.answer,p.approve=function(){u.promise.isPending()&&(log.trace("Call.approve"),p.fire("approve"),u.resolve(!0),q&&q.promise.isPending()&&(q.resolve(!0),q=void 0))},respoke.MediaStats&&(p.getStats=f),p.getLocalElement=function(){return E},p.getRemoteElement=function(){return F},p.addVideo=function(a){return log.trace("Call.addVideo"),a=a||{},a.constraints=a.constraints||{video:!0,audio:!0},a.constraints.audio="boolean"==typeof a.audio?a.audio:a.constraints.audio,a.constraints.video="boolean"==typeof a.video?a.video:a.constraints.video,a.instanceId=o,v.promise.isFulfilled()?(M.startModify({constraints:a.constraints}),q=Q.defer(),q.promise.then(function(){g(a)})):g(a),q.promise},p.addAudio=function(a){return a=a||{},a.constraints=a.constraints||{video:!1,audio:!0},a.constraints.video="boolean"==typeof a.constraints.video?a.constraints.video:!1,a.constraints.audio="boolean"==typeof a.audio?a.audio:a.constraints.audio,a.constraints.video="boolean"==typeof a.video?a.video:a.constraints.video,p.addVideo(a)},p.removeStream=function(a){var b;K.forEach(function(c,d){c.id===a.id&&(c.stop(),b=d)}),K.splice(b,1)},p.startDirectConnection=function(){return J||null},p.removeDirectConnection=function(a){return a=a||{},log.trace("Call.removeDirectConnection"),J&&J.isActive()&&J.close({skipRemove:!0}),0===K.length?(log.debug("Hanging up because there are no local streams."),p.hangup(),void 0):(a.skipModify!==!0&&(M.startModify({directConnection:!1}),q=Q.defer(),q.promise.done(function(){v.resolve(),q=void 0})),void 0)},p.addDirectConnection=function(a){return log.trace("Call.addDirectConnection"),M.startModify({directConnection:!0}),q=Q.defer(),q.promise.then(function(){return h(a)},function(a){throw a})},p.closeDirectConnection=function(){J&&(J.close(),J=null)},p.hangup=function(a){return a=a||{},log.trace("hangup",J),null!==L?(log.info("call.hangup() called when call is already hung up."),void 0):(L=!1,!p.caller&&u.promise.isPending()&&u.reject(new Error("Call hung up before approval.")),K.forEach(function(a){a.stop()}),J&&J.isActive()&&(J.close(),p.remoteEndpoint.directConnection=null),M&&(L=M.close(a)),p.fire("hangup",{sentSignal:L}),p.ignore(),J=null,M=null,void 0)},p.reject=function(a){q&&q.promise.isPending()?(q.reject(new Error("Modify rejected.")),q=void 0):p.hangup(a)},p.isActive=function(){return M.isActive()&&(K.length>0||J&&J.isActive())},p.toggleVideo=function(){p.isActive()&&(G?p.unmuteVideo():p.muteVideo())},p.toggleAudio=function(){p.isActive()&&(H?p.unmuteAudio():p.muteAudio())},p.muteVideo=function(){G||(K.forEach(function(a){a.muteVideo()}),p.fire("mute",{type:"video",muted:!0}),G=!0)},p.unmuteVideo=function(){G&&(K.forEach(function(a){a.unmuteVideo()}),p.fire("mute",{type:"video",muted:!1}),G=!1)},p.muteAudio=function(){H||(K.forEach(function(a){a.muteAudio()}),p.fire("mute",{type:"audio",muted:!0}),H=!0)},p.unmuteAudio=function(){H&&(K.forEach(function(a){a.unmuteAudio()}),p.fire("mute",{type:"audio",muted:!1}),H=!1)},p.listen("signal-offer",i,!0),p.listen("signal-answer",j,!0),p.listen("signal-hangup",n,!0),p.listen("signal-modify",k,!0),M.listen("modify-reject",m,!0),M.listen("modify-accept",l,!0),p.listen("signal-icecandidates",function(a){a.signal.iceCandidates&&a.signal.iceCandidates.length&&a.signal.iceCandidates.forEach(function(a){M.addRemoteCandidate({candidate:a})})},!0),D.getTurnCredentials().done(function(d){I.servers=C.callSettings.servers,I.servers.iceServers=d,c(a),b(),w.resolve()}),p},respoke.DirectConnection=function(a){"use strict";function b(a){k=a.channel,k.onerror=e,k.onmessage=f,k.onopen=g}function c(a){j.listen("open",a.onOpen),j.listen("close",a.onClose),j.listen("message",a.onMessage),j.listen("start",a.onStart),j.listen("error",a.onError),l.listen("direct-connection",b,!0),l.listen("stats",function(a){j.fire("stats",{stats:a.stats})},!0)}function d(a){return l&&l.getStats?(j.listen("stats",a.onStats),delete a.onStats,l.getStats(a)):null}function e(a){j.fire("error",{error:a}),j.close()}function f(a){var b;try{b=JSON.parse(a.data)}catch(c){b=a.data}j.call.remoteEndpoint.fire("message",{message:b,directConnection:j}),j.fire("message",{message:b,endpoint:j.call.remoteEndpoint})}function g(){j.fire("open")}function h(){k=l.createDataChannel("respokeDataChannel"),k.binaryType="arraybuffer",k.onerror=e,k.onmessage=f,k.onopen=g,j.fire("start")}a=a||{};var i=a.instanceId,j=respoke.EventEmitter(a);delete j.instanceId,j.className="respoke.DirectConnection",j.id=respoke.makeGUID(),j.call.caller||(j.call.caller=!1);var k=null,l=(respoke.getClient(i),a.pc);return delete a.pc,c(a),delete j.onOpen,delete j.onClose,delete j.onMessage,respoke.MediaStats&&(j.getStats=d),j.accept=function(a){a=a||{},log.trace("DirectConnection.accept"),c(a),log.debug("I am "+(j.call.caller?"":"not ")+"the caller."),j.call.caller===!0&&h(),j.fire("accept")},j.close=function(a){a=a||{},log.trace("DirectConnection.close"),k&&k.close(),j.fire("close"),j.ignore(),a.skipRemove!==!0&&j.call.removeDirectConnection(),k=null,j.call.remoteEndpoint.directConnection=null,j.call=null,l=null},j.sendMessage=function(a){var b=Q.defer(),c=respoke.handlePromise(b.promise,a.onSuccess,a.onError);return j.isActive()?(k.send(JSON.stringify(a.object||{message:a.message})),b.resolve()):b.reject(new Error("dataChannel not in an open state.")),c},j.reject=j.close,j.isActive=function(){return k&&"open"===k.readyState},j},respoke.PeerConnection=function(a){"use strict";function b(a){a.iceCandidates=[a.candidate],G(a),o.report.candidatesSent.push({candidate:a.candidate})}function c(a){var b=Q.defer(),c=respoke.handlePromise(b.promise,a.onSuccess,a.onError);return r?respoke.MediaStats?(Q.all([s.promise,t.promise]).then(function(){var c=respoke.MediaStatsParser({peerConnection:r,interval:a.interval,onStats:function(a){o.fire("stats",{stats:a}),o.report.stats.push(a)}});o.listen("close",function(){c.stopStats()},!0),b.resolve()}),c):(b.reject(new Error("Statistics module is not loaded.")),c):(b.reject(new Error("Can't get stats, pc is null.")),c)}function d(a){var c=a.candidate;c&&c.candidate&&(v!==!0||-1!==c.candidate.indexOf("typ relay"))&&(o.call.caller&&t.promise.isPending()?w.push(c):b({candidate:c,call:o.call}))}function e(){log.warn("Negotiation needed.")}function f(){for(var a=0;a<w.length;a+=1)b({candidate:w[a],call:o.call});w=[];for(var a=0;a<x.length;a+=1)o.addRemoteCandidate({candidate:x[a]});x=[]}function g(a){a.type="offer",s.promise.isPending()&&(log.debug("setting and sending offer",a),o.report.sdpsSent.push(a),r.setLocalDescription(a,function(){a.type="offer",A({call:o.call,sdp:a}),s.resolve(a)},function(){var a=new Error("Error calling setLocalDescription on offer I created.");o.call.fire("error",{message:a.message}),s.reject(a)}))}function h(a){a.type="answer",log.debug("setting and sending answer",a),o.report.sdpsSent.push(a),o.call.initiator||(o.report.callerconnection=o.call.connectionId),r.setLocalDescription(a,function(){a.type="answer",D({sdp:a,call:o.call}),t.resolve(a)},function(){var a=new Error("Error calling setLocalDescription on answer I created.");o.call.fire("error",{message:a.message}),t.reject()})}function i(a){return-1!==a.indexOf("m=audio")}function j(a){return-1!==a.indexOf("m=video")}function k(a){return t.promise.isPending()?(t.promise.done(f,function(){log.error("set remote desc of answer failed",a.signal.sdp),o.report.callStoppedReason="setRemoteDescription failed at answer.",o.close()}),log.debug("got answer",a.signal),o.report.sdpsReceived.push(a.signal.sdp),o.report.lastSDPString=a.signal.sdp.sdp,o.call.hasAudio=i(a.signal.sdp.sdp),o.call.hasVideo=j(a.signal.sdp.sdp),o.call.initiator&&(o.report.calleeconnection=a.signal.connectionId),o.call.connectionId=a.signal.connectionId,B({call:o.call}),r.setRemoteDescription(new RTCSessionDescription(a.signal.sdp),function(){t.resolve(a.signal.sdp)
},function(){var a=new Error("Exception calling setRemoteDescription on answer I received.");o.report.callStoppedReason=a.message,o.call.fire("error",{message:a.message}),t.reject()}),void 0):(log.debug("Ignoring duplicate answer."),void 0)}function l(a){a.signal.toConnection!==y.connectionId&&(log.verbose("Hanging up because I didn't win the call.",a.signal,y),o.call.hangup({signal:!1}))}function m(a){var b;return log.trace("PC.listenModify",a.signal),"accept"===a.signal.action?(o.call.caller=!0,q.promise.isPending()&&(q.resolve(),o.fire("modify-accept",{signal:a.signal})),void 0):"reject"===a.signal.action?(q.promise.isPending()&&(b=new Error("Remote party cannot negotiate."),log.debug(b.message),q.reject(b),o.fire("modify-reject",{err:b})),void 0):q&&q.promise.isPending()?(b=new Error("Got modify in a negotiating state."),log.debug(b.message),q.reject(b),o.fire("modify-reject",{err:b}),C({action:"reject",call:o.call}),void 0):(q=Q.defer(),s.promise.isPending()||t.promise.isPending()?(b=new Error("Got modify in a precall state."),o.fire("modify-reject",{err:b}),C({action:"reject",call:o.call}),q.reject(b),void 0):(a.signal.directConnection!==!1&&(s=Q.defer(),u=Q.defer(),t=Q.defer()),o.fire("modify-accept",{signal:a.signal}),C({action:"accept",call:o.call}),o.call.caller=!1,q.resolve(),void 0))}a=a||{};var n=a.instanceId,o=respoke.EventEmitter(a);delete o.instanceId,o.className="respoke.PeerConnection";var p;o.state=-1;var q,r=null,s=Q.defer(),t=Q.defer(),u=Q.defer(),v=("function"==typeof a.previewLocalMedia?a.previewLocalMedia:void 0,"boolean"==typeof a.sendOnly?a.sendOnly:!1,"boolean"==typeof a.receiveOnly?a.receiveOnly:!1,"boolean"==typeof a.forceTurn?a.forceTurn:!1),w=[],x=[],y=respoke.getClient(n),z=a.callSettings||{},A=a.signalOffer,B=a.signalConnected,C=a.signalModify,D=a.signalAnswer,E=a.signalHangup,F=a.signalReport,G=a.signalCandidate,H=a.offerOptions||null,I=a.pcOptions||{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]};return o.report={callStarted:0,callStopped:0,callerendpoint:o.call.initiator?y.name:o.call.remoteEndpoint.id,callerconnection:o.call.initiator?y.id:o.call.connectionId,calleeendpoint:o.call.initiator?o.call.remoteEndpoint.id:y.id,calleeconnection:o.call.initiator?o.call.connectionId:y.connectionId,sessionId:o.call.id,lastSDPString:"",sdpsSent:[],sdpsReceived:[],candidatesSent:[],candidatesReceived:[],stats:[],userAgent:navigator.userAgent,os:navigator.platform},o.initOffer=function(){log.info("creating offer",H),r.createOffer(g,function(){log.error("createOffer failed")},H)},o.processOffer=function(a){if(log.trace("processOffer",a),o.call.caller)return log.warn("Got offer in precall state."),o.report.callStoppedReason="Got offer in precall state",E({call:o.call}),s.reject(),void 0;o.report.sdpsReceived.push(a),o.report.lastSDPString=a.sdp,o.call.hasAudio=i(a.sdp),o.call.hasVideo=j(a.sdp);try{r.setRemoteDescription(new RTCSessionDescription(a),function(){log.debug("set remote desc of offer succeeded"),r.createAnswer(function(a){h(a),s.resolve(),f(a)},function(a){a=new Error("Error creating SDP answer."+a.message),o.report.callStoppedReason=a.message,o.call.fire("error",{message:a.message}),s.reject(a)})},function(a){a=new Error("Error calling setRemoteDescription on offer I received."+a.message),o.report.callStoppedReason=a.message,o.call.fire("error",{message:a.message}),s.reject(a)})}catch(b){var c=new Error("Exception calling setRemoteDescription on offer I received."+b.message);o.report.callStoppedReason=c.message,o.call.fire("error",{message:c.message}),s.reject(c)}return s.promise},respoke.MediaStats&&(o.getStats=c),o.init=function(a){a=a||{},z.servers=a.servers||z.servers,z.disableTurn=a.disableTurn||z.disableTurn,log.trace("PC.init"),r||(o.report.callStarted=(new Date).getTime(),r=new RTCPeerConnection(z.servers,I),r.onicecandidate=d,r.onnegotiationneeded=e,r.onaddstream=function(a){o.fire("connect",{stream:a.stream})},r.onremovestream=function(a){o.fire("remote-stream-removed",{stream:a.stream})},r.ondatachannel=function(a){o.fire("direct-connection",{channel:a.channel})},o.getRemoteStreams=r.getRemoteStreams.bind(r),o.getLocalStreams=r.getLocalStreams.bind(r),o.createDataChannel=r.createDataChannel.bind(r))},o.addStream=function(a){r||o.call.fire("error",{message:"Got local stream in a precall state."}),r.addStream(a)},o.close=function(a){return a=a||{},void 0!==p?(log.trace("PeerConnection.close got called twice."),void 0):(p=!0,o.call.caller===!0?s.promise.isPending()&&(p=!1):u.promise.isPending()&&u.reject(new Error("Call hung up before approval.")),p="boolean"==typeof a.signal?a.signal:p,p&&(log.info("sending hangup"),E({call:o.call})),o.report.callStopped=(new Date).getTime(),F({report:o.report}),o.fire("close",{sentSignal:p}),o.ignore(),r&&r.close(),r=null,void 0)},o.isActive=function(){return r&&["completed","connected"].indexOf(r.iceConnectionState)>-1},o.startModify=function(a){q=Q.defer(),q.promise.then(function(){a.directConnection!==!1&&(s=Q.defer(),u=Q.defer(),t=Q.defer())}),C({action:"initiate",call:o.call,constraints:a.constraints,directConnection:a.directConnection})},o.addRemoteCandidate=function(a){if(a=a||{},a.candidate){if(!a.candidate.hasOwnProperty("sdpMLineIndex"))return log.warn("addRemoteCandidate got wrong format!",a,(new Error).stack),void 0;if(!r||o.call.caller&&t.promise.isPending())return x.push(a.candidate),log.debug("Queueing a candidate."),void 0;try{r.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(b){return log.error("Couldn't add ICE candidate: "+b.message,a.candidate),void 0}log.verbose("Got a remote candidate.",a.candidate),o.report.candidatesReceived.push(a.candidate)}},o.call.listen("signal-answer",k,!0),o.call.listen("signal-connected",l,!0),o.call.listen("signal-modify",m,!0),o},respoke.LocalMedia=function(a){"use strict";function b(a){o="boolean"==typeof a.forceTurn?a.forceTurn:o,q="boolean"==typeof a.receiveOnly?a.receiveOnly:q,p="boolean"==typeof a.sendOnly?a.sendOnly:p,m=a.callSettings||m||{},m.servers=a.servers||m.servers,m.constraints=a.constraints||m.constraints,m.disableTurn=a.disableTurn||m.disableTurn}function c(a){return r=a,clearTimeout(l),g.fire("allow"),log.debug("User gave permission to use media."),log.trace("onReceiveUserMedia"),g.getAudioTracks=r.getAudioTracks.bind(r),g.getVideoTracks=r.getVideoTracks.bind(r),null===n?(g.hangup({signal:!1}),void 0):(i=document.createElement("video"),respoke.streams[g.constraints]?(respoke.streams[g.constraints].numPc+=1,g.fire("stream-received",{element:i,stream:r})):(r.numPc=1,respoke.streams[g.constraints]=r,r.id=h.endpointId,attachMediaStream(i,r),i.muted=!0,i.autoplay=!0,i.used=!0,g.fire("stream-received",{element:i,stream:r})),void 0)}function d(){if(log.trace("requestMedia"),g.constraints=m.constraints,!g.constraints)throw new Error("No constraints.");if(respoke.streams[g.constraints])return log.debug("using old stream"),c(respoke.streams[g.constraints]),void 0;try{log.debug("Running getUserMedia with constraints",g.constraints),l=setTimeout(function(){g.fire("requesting-media")},500),getUserMedia(m.constraints,c,e)}catch(a){log.error("Couldn't get user media: "+a.message)}}function e(a){log.trace("onUserMediaError"),1===a.code?(log.warn("Permission denied."),g.fire("error",{error:"Permission denied."})):(log.warn(a),g.fire("error",{error:a.code}))}a=a||{};var f=a.instanceId,g=respoke.EventEmitter(a);delete g.instanceId,g.className="respoke.LocalMedia",g.id=respoke.makeGUID();var h=respoke.getClient(f),i=null,j=!1,k=!1,l=0,m=a.callSettings,n=a.pc;delete g.pc;var o,p,q,r;return b(a),g.getElement=function(){return i},g.muteVideo=function(){j||(r.getVideoTracks().forEach(function(a){a.enabled=!1}),g.fire("mute",{type:"video",muted:!0}),j=!0)},g.unmuteVideo=function(){j&&(r.getVideoTracks().forEach(function(a){a.enabled=!0}),g.fire("mute",{type:"video",muted:!1}),j=!1)},g.muteAudio=function(){k||(r.getAudioTracks().forEach(function(a){a.enabled=!1}),g.fire("mute",{type:"audio",muted:!0}),k=!0)},g.unmuteAudio=function(){k&&(r.getAudioTracks().forEach(function(a){a.enabled=!0}),g.fire("mute",{type:"audio",muted:!1}),k=!1)},g.stop=function(){null!==r&&(r.numPc-=1,0===r.numPc&&(r.stop(),delete respoke.streams[g.constraints]),r=null,g.fire("stop"))},d(),g};
//# sourceMappingURL=respoke.min.map